<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>标准详情 - 国家市场监督管理总局技术创新中心</title>
    <!-- 引入 Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- 引入 FontAwesome 图标库 -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'tech-blue': '#004098',   
                        'tech-dark': '#003380',
                        'text-main': '#333333',
                    },
                    fontFamily: {
                        'slogan': ['STKaiti', 'KaiTi', '楷体', 'FangSong', 'SimSun', 'serif'], 
                        'sans': ['Microsoft YaHei', 'PingFang SC', 'sans-serif'],
                    }
                }
            }
        }
    </script>
    <style>
        body { font-family: "Microsoft YaHei", sans-serif; }
        
        /* --- 头部科技感背景 (与 Index 保持一致) --- */
        .header-tech-bg {
            background-color: #001540;
            background-image: 
                radial-gradient(circle at 50% 0%, rgba(59, 130, 246, 0.15) 0%, transparent 50%),
                linear-gradient(to right, #001540, #003380, #001540);
            position: relative;
        }
        .header-tech-bg::before {
            content: ""; position: absolute; top: 0; left: 0; right: 0; bottom: 0;
            background-image: 
                linear-gradient(rgba(255, 255, 255, 0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(255, 255, 255, 0.03) 1px, transparent 1px);
            background-size: 30px 30px; pointer-events: none;
        }

        /* 导航栏特效 */
        .nav-item { position: relative; }
        .nav-item::after {
            content: ''; position: absolute; bottom: 8px; left: 50%; width: 0%; height: 2px;
            background-color: #fff; transform: translateX(-50%); transition: width 0.3s ease;
        }
        .nav-item:hover::after { width: 60%; }
        
        /* 下拉菜单动画 */
        .group:hover .group-hover\:block { display: block; animation: fadeIn 0.2s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

        /* 状态标签颜色 */
        .badge-active { background-color: #dcfce7; color: #166534; border: 1px solid #bbf7d0; } /* 现行 */
        .badge-draft { background-color: #fef9c3; color: #854d0e; border: 1px solid #fde047; } /* 征求意见 */
        .badge-upcoming { background-color: #dbeafe; color: #1e40af; border: 1px solid #bfdbfe; } /* 即将实施 */
        .badge-expired { background-color: #f3f4f6; color: #4b5563; border: 1px solid #e5e7eb; } /* 废止 */
    </style>
</head>
<body class="bg-gray-50 text-[#333] flex flex-col min-h-screen">

    <!-- ================= 1. 顶部 Header (与 Index 完全一致) ================= -->
    <div class="w-full text-white pb-0 header-tech-bg">
        <header class="max-w-[1400px] mx-auto px-4 sm:px-6 lg:px-8 py-7 relative z-10">
            <div class="flex flex-col lg:flex-row justify-between items-center gap-6">
                <!-- 左侧：Logo + 标题 -->
                <div class="flex items-center gap-5 self-start lg:self-center">
                    <div class="w-16 h-16 shrink-0 flex items-center justify-center">
                        <img src="figure/nevsc_logo.png" alt="Logo" class="w-full h-full object-contain drop-shadow-md" 
                             onerror="this.parentElement.innerHTML='<div class=\'text-white font-bold border border-white/30 p-2 rounded\'>LOGO</div>'">
                    </div>
                    <div class="flex flex-col justify-center gap-1">
                        <h1 class="text-sm md:text-lg text-blue-100 font-bold tracking-wide opacity-90 text-justify">
                            国家市场监督管理总局技术创新中心
                        </h1>
                        <h2 class="text-sm md:text-lg text-blue-100 font-medium tracking-wide opacity-90 text-justify">
                            (新能源汽车数字监管技术及应用)
                        </h2>
                    </div>
                </div>

                <!-- 右侧：搜索 -->
                <div class="flex flex-col items-end gap-2 w-full lg:w-auto mt-4 lg:mt-0">
                    <div class="relative w-full md:w-64 group">
                        <input type="text" id="global-search-input" placeholder="输入关键词..." autocomplete="off"
                            class="w-full bg-white/10 border border-white/20 text-white text-sm rounded-full pl-4 pr-10 py-1.5 
                                    focus:outline-none focus:bg-white/15 focus:border-blue-300 transition shadow-inner backdrop-blur-sm">
                        <button id="global-search-btn" class="absolute right-3 top-1/2 -translate-y-1/2 text-white/70 hover:text-white transition">
                            <i class="fa-solid fa-magnifying-glass text-lg"></i>
                        </button>
                        <div id="search-dropdown" class="hidden absolute top-full left-0 right-0 mt-2 bg-white rounded-lg shadow-xl border border-gray-100 overflow-hidden z-50"></div>
                    </div>
                </div>
            </div>
        </header>

        <!-- 导航栏 -->
        <nav class="border-t border-white/10 mt-2 relative z-10" style="background-color: rgba(255, 255, 255, 0.05);"> 
            <div class="max-w-[1400px] mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex flex-wrap justify-center space-x-2">
                    <a href="index.html" class="nav-item text-blue-100 hover:text-white px-8 py-4 text-base tracking-widest transition relative">首页</a>
                    <a href="about.html" class="nav-item text-blue-100 hover:text-white px-6 py-4 font-medium transition text-base tracking-wide">中心概况</a>
                    <a href="news.html" class="nav-item text-blue-100 hover:text-white px-6 py-4 font-medium transition text-base tracking-wide">新闻动态</a>
                    <a href="activity.html" class="nav-item text-blue-100 hover:text-white px-6 py-4 font-medium transition text-base tracking-wide">行业活动</a>
                    <!-- 当前页高亮 -->
                    <a href="standards.html" class="text-white font-bold px-6 py-4 font-medium transition text-base tracking-wide relative after:content-[''] after:absolute after:bottom-0 after:left-0 after:w-full after:h-1 after:bg-white">标准研制</a>
                    <a href="research.html" class="nav-item text-blue-100 hover:text-white px-6 py-4 font-medium transition text-base tracking-wide">技术研究</a>
                    <div class="relative group h-full">
                        <button class="nav-item text-blue-100 hover:text-white px-6 py-4 font-medium transition flex items-center h-full text-base tracking-wide">
                            更多 <i class="fa-solid fa-angle-down ml-2 text-xs opacity-70"></i>
                        </button>
                        <div class="absolute left-0 top-full w-36 bg-white shadow-xl rounded-b-md hidden group-hover:block z-50">
                            <a href="#" class="block px-4 py-3 text-sm text-gray-700 hover:bg-blue-50 hover:text-[#004098] border-b border-gray-50">党建风采</a>
                            <a href="#" class="block px-4 py-3 text-sm text-gray-700 hover:bg-blue-50 hover:text-[#004098] border-b border-gray-50">人才招聘</a>
                            <a href="#" class="block px-4 py-3 text-sm text-gray-700 hover:bg-blue-50 hover:text-[#004098]">联系我们</a>
                        </div>
                    </div>
                </div>
            </div>
        </nav>
    </div>

    <!-- ================= 2. 面包屑导航 ================= -->
    <div class="bg-white border-b border-gray-200 shadow-sm">
        <div class="max-w-[1400px] mx-auto px-4 sm:px-6 lg:px-8 py-3">
            <div class="text-sm text-gray-500 flex items-center">
                <a href="index.html" class="hover:text-[#004098] transition"><i class="fa-solid fa-house mr-1"></i> 首页</a>
                <span class="mx-2 text-gray-300">/</span>
                <a href="standards.html" class="hover:text-[#004098] transition">标准研制</a>
                <span class="mx-2 text-gray-300">/</span>
                <span class="text-gray-800 font-medium">标准详情</span>
            </div>
        </div>
    </div>

    <!-- ================= 3. 详情主体 ================= -->
    <main class="max-w-[1400px] mx-auto px-4 sm:px-6 lg:px-8 py-10 flex-grow w-full">
        
        <!-- Loading 提示 -->
        <div id="loading" class="text-center py-20 text-gray-500">
            <i class="fa-solid fa-spinner fa-spin text-3xl mb-4 text-[#004098]"></i>
            <p>正在加载标准详情...</p>
        </div>

        <div id="content-area" class="hidden bg-white rounded shadow-sm border border-gray-100 p-8 md:p-12">
            
            <!-- 头部基本信息 -->
            <div class="border-b border-gray-100 pb-8 mb-8">
                <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-4">
                    <div class="flex items-center gap-3">
                        <span id="std-type-tag" class="bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded font-bold uppercase"></span>
                        <h1 class="text-2xl md:text-4xl font-bold text-[#004098] font-mono tracking-tight" id="std-code">加载中...</h1>
                    </div>
                    <span id="std-status" class="mt-2 md:mt-0 px-3 py-1 rounded text-sm font-bold">...</span>
                </div>
                
                <h2 class="text-xl md:text-2xl font-medium text-[#333] mb-6 leading-snug" id="std-title">...</h2>
                
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 text-sm text-gray-600 bg-gray-50 p-5 rounded border border-gray-100">
                    <div class="flex items-center"><i class="fa-regular fa-calendar-check mr-2 text-[#004098]"></i><span class="font-bold mr-2">发布日期：</span> <span id="std-publish-date">-</span></div>
                    <div class="flex items-center"><i class="fa-regular fa-calendar-plus mr-2 text-[#004098]"></i><span class="font-bold mr-2">实施日期：</span> <span id="std-implement-date">-</span></div>
                    <div class="flex items-center"><i class="fa-solid fa-building-columns mr-2 text-[#004098]"></i><span class="font-bold mr-2">主管部门：</span> <span id="std-dept">相关单位</span></div>
                </div>
            </div>

            <!-- 详细内容与操作 -->
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-10">
                
                <!-- 左侧：内容摘要与预览 -->
                <div class="lg:col-span-2 space-y-8">
                    <div>
                        <h3 class="font-bold text-[#333] border-l-4 border-[#004098] pl-3 mb-4 text-lg">适用范围 / 标准描述</h3>
                        <div id="std-desc" class="text-gray-600 leading-relaxed text-justify text-base p-4 bg-gray-50/50 rounded">
                            <!-- JS 填充 -->
                        </div>
                    </div>
                    
                    <div>
                        <h3 class="font-bold text-[#333] border-l-4 border-[#004098] pl-3 mb-4 text-lg">文件预览</h3>
                        <!-- 如果有PDF显示iframe，否则显示占位符 -->
                        <div id="pdf-preview-container" class="w-full h-[500px] bg-gray-100 border border-gray-200 rounded flex flex-col items-center justify-center text-gray-400">
                            <!-- 默认占位 -->
                            <i class="fa-regular fa-file-pdf text-5xl mb-4 text-gray-300"></i>
                            <p>暂无预览文件</p>
                        </div>
                    </div>
                </div>

                <!-- 右侧：下载与反馈 -->
                <div class="lg:col-span-1 space-y-6">
                    
                    <!-- 下载卡片 -->
                    <div class="bg-blue-50 p-6 rounded border border-blue-100 shadow-sm relative overflow-hidden group">
                        <div class="absolute -right-6 -top-6 w-24 h-24 bg-blue-100 rounded-full opacity-50 group-hover:scale-110 transition"></div>
                        <h3 class="font-bold text-[#004098] mb-4 text-lg relative z-10">获取标准全文</h3>
                        
                        <div id="download-section">
                            <a id="download-btn" href="#" target="_blank" class="block w-full bg-[#004098] hover:bg-[#003380] text-white py-3 rounded font-bold transition mb-3 flex items-center justify-center shadow-md">
                                <i class="fa-solid fa-download mr-2"></i> 下载 PDF 文件
                            </a>
                            <p class="text-xs text-gray-500 text-center">点击下载完整版标准文件</p>
                        </div>
                        
                        <div id="no-download-section" class="hidden">
                            <button disabled class="w-full bg-gray-300 text-gray-500 py-3 rounded font-bold cursor-not-allowed flex items-center justify-center">
                                <i class="fa-solid fa-ban mr-2"></i> 暂无电子版
                            </button>
                            <p class="text-xs text-gray-500 text-center mt-2">该标准文件暂未上传或不可公开下载</p>
                        </div>
                    </div>

                    <!-- 意见反馈 -->
                    <div class="bg-white p-6 rounded border border-gray-200 shadow-sm">
                        <h3 class="font-bold text-gray-800 mb-4 text-lg">意见反馈</h3>
                        <p class="text-sm text-gray-500 mb-4 leading-relaxed">如果您对本标准有任何建议、疑问或发现内容错误，请通过邮件反馈给我们。</p>
                        <a href="mailto:nevsc@caeri.com.cn" class="block w-full border border-gray-300 text-gray-600 py-2 rounded hover:bg-gray-50 hover:text-[#004098] hover:border-[#004098] transition text-center font-medium">
                            <i class="fa-regular fa-envelope mr-2"></i> 发送邮件反馈
                        </a>
                    </div>

                    <!-- 提示信息
                    <div class="bg-yellow-50 p-4 rounded border border-yellow-100 text-xs text-yellow-700">
                        <p><i class="fa-solid fa-circle-info mr-1"></i> <strong>提示：</strong> 本平台提供的标准文本仅供参考，请以正式出版物为准。</p>
                    </div> -->

                </div>

            </div>
        </div>

    </main>

    <!-- ================= 4. 页脚 (与 Index 完全一致) ================= -->
    <footer class="bg-[#1e293b] text-gray-400 pt-12 pb-8 mt-auto border-t-4 border-[#004098]">
        <div class="max-w-[1400px] mx-auto px-4 sm:px-6 lg:px-8">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-10 mb-10">
                <div class="col-span-1 md:col-span-2">
                    <h4 class="text-white font-bold text-lg mb-5 border-l-4 border-[#004098] pl-3">相关部门链接</h4>
                    <div class="grid grid-cols-2 gap-y-4 gap-x-6 text-sm">
                        <a href="https://www.samr.gov.cn/" target="_blank" class="hover:text-white hover:underline flex items-center transition"><i class="fa-solid fa-link mr-2 text-gray-600"></i>国家市场监督管理总局</a>
                        <a href="https://www.samrdprc.org.cn/" target="_blank" class="hover:text-white hover:underline flex items-center transition"><i class="fa-solid fa-link mr-2 text-gray-600"></i>国家市场监督管理总局缺陷产品召回技术中心</a>
                        <a href="https://www.ccic.com/" target="_blank" class="hover:text-white hover:underline flex items-center transition"><i class="fa-solid fa-link mr-2 text-gray-600"></i>中国检验认证集团</a>
                        <a href="https://www.caeri.com.cn/" target="_blank" class="hover:text-white hover:underline flex items-center transition"><i class="fa-solid fa-link mr-2 text-gray-600"></i>中国汽车工程研究院股份有限公司</a>
                    </div>
                </div>
                <div class="col-span-1 md:col-span-1">
                    <h4 class="text-white font-bold text-lg mb-5 border-l-4 border-[#004098] pl-3">联系我们</h4>
                    <ul class="space-y-3 text-sm">
                        <li class="flex items-start"><i class="fa-solid fa-location-dot mt-1 mr-1 text-gray-500"></i> 地址：北京市朝阳区西坝河东里18号中检大厦</li>
                        <li class="flex items-center"><i class="fa-solid fa-envelope mr-3 text-gray-500"></i> 邮箱：nevsc@caeri.com.cn</li>
                        <li class="flex items-center"><i class="fa-solid fa-phone mr-3 text-gray-500"></i> 电话：010-88888888</li>
                    </ul>
                </div>
                <div class="col-span-1 md:col-span-1 flex flex-col items-center md:items-start">
                    <h4 class="text-white font-bold text-lg mb-5">关注我们</h4>
                    <div class="flex items-center gap-4">
                        <div class="bg-white p-1.5 rounded-lg shadow-lg"><img src="figure/QRcode.jpg" alt="微信公众号" class="w-20 h-20"></div>
                        <div class="text-xs text-gray-400"><p class="mb-1 text-white font-bold">官方微信</p><p>扫一扫了解更多</p><p>行业动态</p></div>
                    </div>
                </div>
            </div>
            <div class="border-t border-gray-700 pt-8 text-center text-xs text-gray-500 font-medium">
                <p>&copy; 2025 国家市场监督管理总局技术创新中心（新能源汽车数字监管技术及应用） 版权所有</p>
            </div>
        </div>
    </footer>

    <!-- 逻辑脚本 -->
    <script type="module">
        import { getItemById } from './js/api.js';

        document.addEventListener('DOMContentLoaded', async function() {
            const urlParams = new URLSearchParams(window.location.search);
            const id = urlParams.get('id');

            if (!id) {
                document.getElementById('loading').innerHTML = '<span class="text-red-500">错误：未找到标准ID</span>';
                return;
            }

            try {
                // 从数据库获取数据
                const item = await getItemById('standards', id);

                if (item) {
                    // 更新页面标题
                    document.title = `${item.code} 标准详情 - 技术创新中心`;
                    
                    // 填充基本信息
                    document.getElementById('std-code').innerText = item.code || '未编号';
                    document.getElementById('std-title').innerText = item.title || '无标题';
                    document.getElementById('std-publish-date').innerText = item.publish_date || '待定';
                    document.getElementById('std-implement-date').innerText = item.implement_date || '待定';
                    document.getElementById('std-dept').innerText = item.department || '相关主管部门';
                    document.getElementById('std-desc').innerText = item.description || '暂无详细描述...';

                    // 类型标签
                    const typeMap = { 'GB': '国家标准', 'QC': '行业标准', 'DB': '地方标准', 'T': '团体标准', 'other': '其他' };
                    document.getElementById('std-type-tag').innerText = typeMap[item.type] || item.type;

                    // 状态 Badge
                    const statusBadge = document.getElementById('std-status');
                    const statusConfig = {
                        'active': { text: '现行', class: 'badge-active' },
                        'draft': { text: '征求意见', class: 'badge-draft' },
                        'upcoming': { text: '即将实施', class: 'badge-upcoming' },
                        'expired': { text: '已废止', class: 'badge-expired' }
                    };
                    const config = statusConfig[item.status] || { text: '未知', class: 'bg-gray-100 text-gray-600' };
                    statusBadge.innerText = config.text;
                    statusBadge.className = `px-3 py-1 rounded text-sm font-bold ${config.class}`;

                    // PDF 下载与预览逻辑
                    if (item.pdf_url) {
                        // 启用下载按钮
                        document.getElementById('download-btn').href = item.pdf_url;
                        
                        // 尝试在 iframe 中预览 PDF (浏览器原生支持)
                        // 注意：如果跨域策略限制，iframe 可能无法加载，此时仅保留下载按钮
                        const container = document.getElementById('pdf-preview-container');
                        container.innerHTML = `
                            <iframe src="${item.pdf_url}" class="w-full h-full rounded border-none">
                                <p>您的浏览器不支持 PDF 预览，请下载查看。</p>
                            </iframe>
                        `;
                    } else {
                        // 无文件状态
                        document.getElementById('download-section').classList.add('hidden');
                        document.getElementById('no-download-section').classList.remove('hidden');
                    }

                    // 显示内容区域
                    document.getElementById('loading').classList.add('hidden');
                    document.getElementById('content-area').classList.remove('hidden');
                } else {
                    document.getElementById('loading').innerHTML = '未找到该标准信息';
                }
            } catch (error) {
                console.error(error);
                document.getElementById('loading').innerHTML = '数据加载失败，请检查网络连接';
            }
        });
    </script>
    <!-- 引入 Search 逻辑 -->
    <script type="module" src="js/search.js"></script>
</body>
</html>