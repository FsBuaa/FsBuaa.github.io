<!-- --- 文件：activity.html --- -->

<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>行业活动 - 国家市场监督管理总局技术创新中心</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: { 'tech-blue': '#004098', 'tech-dark': '#003380' },
                    fontFamily: { 'sans': ['Microsoft YaHei', 'sans-serif'] }
                }
            }
        }
    </script>
    <style>
        body { font-family: "Microsoft YaHei", sans-serif; }
        .header-tech-bg { background-color: #001540; background-image: radial-gradient(circle at 50% 0%, rgba(59, 130, 246, 0.15) 0%, transparent 50%), linear-gradient(to right, #001540, #003380, #001540); position: relative; }
        .header-tech-bg::before { content: ""; position: absolute; top: 0; left: 0; right: 0; bottom: 0; background-image: linear-gradient(rgba(255, 255, 255, 0.03) 1px, transparent 1px), linear-gradient(90deg, rgba(255, 255, 255, 0.03) 1px, transparent 1px); background-size: 30px 30px; pointer-events: none; }
        .nav-item { position: relative; }
        .nav-item::after { content: ''; position: absolute; bottom: 8px; left: 50%; width: 0%; height: 2px; background-color: #fff; transform: translateX(-50%); transition: width 0.3s ease; }
        .nav-item:hover::after { width: 60%; }
        
        /* 下拉菜单动画 */
        .group:hover .group-hover\:block { display: block; animation: fadeIn 0.2s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

        .fade-in { animation: fadeIn 0.5s ease-in-out; }

        /* 时间线样式 */
        .timeline-dot { width: 12px; height: 12px; background: #fff; border: 3px solid #004098; border-radius: 50%; position: absolute; left: -6px; top: 4px; }
        .timeline-item { position: relative; border-left: 2px solid #e5e7eb; padding-left: 20px; padding-bottom: 20px; }
        .timeline-item:last-child { border-left: 2px solid transparent; }
    </style>
</head>
<body class="bg-gray-50 text-[#333] flex flex-col min-h-screen">

    <!-- ================= 1. 顶部 Header (与 Index 一致) ================= -->
    <div class="w-full text-white pb-0 header-tech-bg">
        <header class="max-w-[1400px] mx-auto px-4 sm:px-6 lg:px-8 py-7 relative z-10">
            <div class="flex flex-col lg:flex-row justify-between items-center gap-6">
                <!-- 左侧：Logo + 标题 -->
                <div class="flex items-center gap-5 self-start lg:self-center">
                    <div class="w-16 h-16 shrink-0 flex items-center justify-center">
                        <img src="figure/nevsc_logo.png" alt="Logo" class="w-full h-full object-contain drop-shadow-md" 
                             onerror="this.parentElement.innerHTML='<div class=\'text-white font-bold border border-white/30 p-2 rounded\'>LOGO</div>'">
                    </div>
                    <div class="flex flex-col justify-center gap-1">
                        <h1 class="text-sm md:text-lg text-blue-100 font-bold tracking-wide opacity-90 text-justify">
                            国家市场监督管理总局技术创新中心
                        </h1>
                        <h2 class="text-sm md:text-lg text-blue-100 font-medium tracking-wide opacity-90 text-justify">
                            (新能源汽车数字监管技术及应用)
                        </h2>
                    </div>
                </div>

                <!-- 右侧：搜索 -->
                <div class="flex flex-col items-end gap-2 w-full lg:w-auto mt-4 lg:mt-0">
                    <div class="relative w-full md:w-64 group">
                        <input type="text" id="global-search-input" placeholder="输入关键词..." autocomplete="off"
                            class="w-full bg-white/10 border border-white/20 text-white text-sm rounded-full pl-4 pr-10 py-1.5 
                                    focus:outline-none focus:bg-white/15 focus:border-blue-300 transition shadow-inner backdrop-blur-sm">
                        <button id="global-search-btn" class="absolute right-3 top-1/2 -translate-y-1/2 text-white/70 hover:text-white transition">
                            <i class="fa-solid fa-magnifying-glass text-lg"></i>
                        </button>
                        <div id="search-dropdown" class="hidden absolute top-full left-0 right-0 mt-2 bg-white rounded-lg shadow-xl border border-gray-100 overflow-hidden z-50"></div>
                    </div>
                </div>
            </div>
        </header>

        <!-- 导航栏 -->
        <nav class="border-t border-white/10 mt-2 relative z-10" style="background-color: rgba(255, 255, 255, 0.05);"> 
            <div class="max-w-[1400px] mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex flex-wrap justify-center space-x-2">
                    <a href="index.html" class="nav-item text-blue-100 hover:text-white px-8 py-4 text-base tracking-widest transition relative">首页</a>
                    <a href="about.html" class="nav-item text-blue-100 hover:text-white px-6 py-4 font-medium transition text-base tracking-wide">中心概况</a>
                    <a href="news.html" class="nav-item text-blue-100 hover:text-white px-6 py-4 font-medium transition text-base tracking-wide">新闻动态</a>
                    <a href="activity.html" class="text-white font-bold px-6 py-4 font-medium transition text-base tracking-wide relative after:content-[''] after:absolute after:bottom-0 after:left-0 after:w-full after:h-1 after:bg-white">行业活动</a>
                    <a href="standards.html" class="nav-item text-blue-100 hover:text-white px-6 py-4 font-medium transition text-base tracking-wide">标准研制</a>
                    <a href="research.html" class="nav-item text-blue-100 hover:text-white px-6 py-4 font-medium transition text-base tracking-wide">技术研究</a>
                    <div class="relative group h-full">
                        <button class="nav-item text-blue-100 hover:text-white px-6 py-4 font-medium transition flex items-center h-full text-base tracking-wide">
                            更多 <i class="fa-solid fa-angle-down ml-2 text-xs opacity-70"></i>
                        </button>
                        <div class="absolute left-0 top-full w-36 bg-white shadow-xl rounded-b-md hidden group-hover:block z-50">
                            <a href="#" class="block px-4 py-3 text-sm text-gray-700 hover:bg-blue-50 hover:text-[#004098] border-b border-gray-50">党建风采</a>
                            <a href="#" class="block px-4 py-3 text-sm text-gray-700 hover:bg-blue-50 hover:text-[#004098] border-b border-gray-50">人才招聘</a>
                            <a href="#" class="block px-4 py-3 text-sm text-gray-700 hover:bg-blue-50 hover:text-[#004098]">联系我们</a>
                        </div>
                    </div>
                </div>
            </div>
        </nav>
    </div>

    <!-- 面包屑 -->
    <div class="bg-white border-b border-gray-200 shadow-sm">
        <div class="max-w-[1400px] mx-auto px-4 sm:px-6 lg:px-8 py-3">
            <div class="text-sm text-gray-500 flex items-center">
                <a href="index.html" class="hover:text-[#004098] transition"><i class="fa-solid fa-house mr-1"></i> 首页</a>
                <span class="mx-2 text-gray-300">/</span>
                <span class="text-gray-800 font-medium">行业活动</span>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <main class="w-full bg-gray-50 py-10 flex-grow">
        <div class="max-w-[1400px] mx-auto px-4 sm:px-6 lg:px-8">
            
            <!-- Banner -->
            <div class="relative w-full h-56 md:h-72 rounded-xl overflow-hidden shadow-lg mb-12 group">
                <img src="https://images.unsplash.com/photo-1517245386807-bb43f82c33c4?q=80&w=2070" class="w-full h-full object-cover transform group-hover:scale-105 transition duration-700" alt="大赛Banner">
                <div class="absolute inset-0 bg-gradient-to-r from-[#004098]/90 via-[#004098]/60 to-transparent flex items-center px-10">
                    <div class="text-white max-w-2xl">
                        <div class="inline-block bg-yellow-500 text-xs font-bold px-3 py-1 rounded mb-4">历届赛事回顾</div>
                        <h1 class="text-3xl md:text-4xl font-bold mb-4">以赛聚智 以赛促研 以赛育才</h1>
                            <p class="text-blue-100 text-lg leading-relaxed">创新中心已成功举办 4 次全国性大赛，吸引全国 <span class="text-yellow-400 font-bold text-xl mx-1">300+</span> 高校/企业团队报名参赛</p>
                    </div>
                </div>
            </div>

            <!-- Tab 切换 (动态生成) -->
            <div id="tabs-container" class="flex flex-wrap justify-center mb-12 border-b border-gray-200 gap-x-6">
                <!-- JS 将在这里动态插入 Tabs，支持后台新增的类型 -->
            </div>

            <!-- 动态内容容器 -->
            <div id="activity-container" class="space-y-12 fade-in min-h-[400px]">
                <div class="text-center py-20 text-gray-400">
                    <i class="fa-solid fa-spinner fa-spin text-2xl mb-2"></i>
                    <p>正在从数据库加载赛事信息...</p>
                </div>
            </div>

        </div>
    </main>

    <!-- Footer (与 Index 一致) -->
    <footer class="bg-[#1e293b] text-gray-400 pt-12 pb-8 mt-auto border-t-4 border-[#004098]">
        <div class="max-w-[1400px] mx-auto px-4 sm:px-6 lg:px-8">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-10 mb-10">
                <div class="col-span-1 md:col-span-2">
                    <h4 class="text-white font-bold text-lg mb-5 border-l-4 border-[#004098] pl-3">相关部门链接</h4>
                    <div class="grid grid-cols-2 gap-y-4 gap-x-6 text-sm">
                        <a href="https://www.samr.gov.cn/" target="_blank" class="hover:text-white hover:underline flex items-center transition"><i class="fa-solid fa-link mr-2 text-gray-600"></i>国家市场监督管理总局</a>
                        <a href="https://www.samrdprc.org.cn/" target="_blank" class="hover:text-white hover:underline flex items-center transition"><i class="fa-solid fa-link mr-2 text-gray-600"></i>国家市场监督管理总局缺陷产品召回技术中心</a>
                        <a href="https://www.ccic.com/" target="_blank" class="hover:text-white hover:underline flex items-center transition"><i class="fa-solid fa-link mr-2 text-gray-600"></i>中国检验认证集团</a>
                        <a href="https://www.caeri.com.cn/" target="_blank" class="hover:text-white hover:underline flex items-center transition"><i class="fa-solid fa-link mr-2 text-gray-600"></i>中国汽车工程研究院股份有限公司</a>
                    </div>
                </div>
                <div class="col-span-1 md:col-span-1">
                    <h4 class="text-white font-bold text-lg mb-5 border-l-4 border-[#004098] pl-3">联系我们</h4>
                    <ul class="space-y-3 text-sm">
                        <li class="flex items-start"><i class="fa-solid fa-location-dot mt-1 mr-1 text-gray-500"></i> 地址：北京市朝阳区西坝河东里18号中检大厦</li>
                        <li class="flex items-center"><i class="fa-solid fa-envelope mr-3 text-gray-500"></i> 邮箱：nevsc@caeri.com.cn</li>
                        <li class="flex items-center"><i class="fa-solid fa-phone mr-3 text-gray-500"></i> 电话：010-88888888</li>
                    </ul>
                </div>
                <div class="col-span-1 md:col-span-1 flex flex-col items-center md:items-start">
                    <h4 class="text-white font-bold text-lg mb-5">关注我们</h4>
                    <div class="flex items-center gap-4">
                        <div class="bg-white p-1.5 rounded-lg shadow-lg"><img src="figure/QRcode.jpg" alt="微信公众号" class="w-20 h-20"></div>
                        <div class="text-xs text-gray-400"><p class="mb-1 text-white font-bold">官方微信</p><p>扫一扫了解更多</p><p>行业动态</p></div>
                    </div>
                </div>
            </div>
            <div class="border-t border-gray-700 pt-8 text-center text-xs text-gray-500 font-medium">
                <p>&copy; 2025 国家市场监督管理总局技术创新中心（新能源汽车数字监管技术及应用） 版权所有</p>
            </div>
        </div>
    </footer>

    <!-- 逻辑脚本 -->
    <script type="module">
        import { supabase } from './js/api.js';

        // 默认分类设置为中文
        let currentCategory = '全国新能源汽车动力电池安全预警算法大赛';
        let allCategories = ['全国新能源汽车动力电池安全预警算法大赛', '中国青年科技创新揭榜挂帅擂台赛']; // 默认存在的两个

        window.switchCategory = (category) => {
            currentCategory = category;
            updateTabStyles();
            loadActivities();
        }

        function updateTabStyles() {
            const container = document.getElementById('tabs-container');
            const buttons = container.querySelectorAll('button');
            buttons.forEach(btn => {
                const cat = btn.getAttribute('data-category');
                if (cat === currentCategory) {
                    btn.className = "px-6 py-4 text-lg font-bold text-[#004098] border-b-4 border-[#004098] focus:outline-none transition whitespace-nowrap";
                } else {
                    btn.className = "px-6 py-4 text-lg font-bold text-gray-500 hover:text-[#004098] border-b-4 border-transparent hover:border-gray-300 focus:outline-none transition whitespace-nowrap";
                }
            });
        }

        async function initTabs() {
            const container = document.getElementById('tabs-container');
            // 获取所有活动以提取分类
            const { data } = await supabase.from('activities').select('category');
            if (data && data.length > 0) {
                const dbCats = [...new Set(data.map(i => i.category).filter(c => c))];
                // 合并默认分类和数据库中新发现的分类
                dbCats.forEach(c => {
                    if (!allCategories.includes(c)) allCategories.push(c);
                });
            }

            // 渲染 Tab 按钮
            let html = '';
            allCategories.forEach(cat => {
                html += `<button onclick="switchCategory('${cat}')" data-category="${cat}" class="px-6 py-4 text-lg font-bold text-gray-500 hover:text-[#004098] border-b-4 border-transparent hover:border-gray-300 focus:outline-none transition whitespace-nowrap">${cat}</button>`;
            });
            container.innerHTML = html;
            updateTabStyles();
        }

        async function loadActivities() {
            const container = document.getElementById('activity-container');
            container.innerHTML = '<div class="text-center py-20 text-gray-400"><i class="fa-solid fa-spinner fa-spin text-2xl mb-2"></i><p>加载中...</p></div>';

            try {
                // 1. 获取数据
                const { data, error } = await supabase
                    .from('activities')
                    .select('*')
                    .eq('category', currentCategory)
                    .order('created_at', { ascending: false });

                if (error) throw error;

                // 2. 准备 HTML
                let html = '';

                // 修改点：如果是算法大赛，显示特定的筹备中提示横幅
                if (currentCategory === '全国新能源汽车动力电池安全预警算法大赛') {
                    html += `
                        <div class="bg-gradient-to-r from-blue-50 to-white border border-blue-100 rounded-lg p-6 mb-8 flex flex-col md:flex-row items-start md:items-center shadow-sm">
                            <div class="bg-[#004098] text-white w-12 h-12 flex items-center justify-center rounded-full mr-4 shrink-0 mb-3 md:mb-0">
                                <i class="fa-solid fa-hourglass-half"></i>
                            </div>
                            <div>
                                <h3 class="text-lg font-bold text-[#004098]">第 三 届大赛筹备中</h3>
                                <p class="text-gray-600 text-sm mt-1 leading-relaxed">
                                    预计将于 <span class="font-bold text-gray-800">2026年3月</span> 启动报名，敬请关注官网通知 
                                    <span class="inline-block bg-gray-200 text-gray-500 text-xs px-2 py-0.5 rounded ml-0 md:ml-2 mt-2 md:mt-0">暂未开放报名</span>
                                </p>
                            </div>
                        </div>
                    `;
                }

                if (!data || data.length === 0) {
                    html += `
                        <div class="bg-gray-50 p-10 rounded-lg text-center border border-dashed border-gray-300">
                            <i class="fa-regular fa-calendar-xmark text-4xl text-gray-300 mb-4"></i>
                            <p class="text-gray-500">该分类下暂无赛事记录</p>
                        </div>`;
                    container.innerHTML = html;
                    return;
                }

                // 3. 渲染列表
                html += `
                    <div class="bg-white p-8 md:p-12 rounded shadow-sm border border-gray-100">
                        <div class="text-center mb-10">
                            <h2 class="text-2xl font-bold text-[#333]">${currentCategory} · 赛事记录</h2>
                            <p class="text-gray-500 mt-2">按时间顺序回顾历届精彩</p>
                        </div>
                        <div class="relative space-y-16">
                            <div class="absolute left-6 md:left-1/2 top-0 bottom-0 w-0.5 bg-gray-200 -translate-x-1/2 hidden md:block"></div>
                `;

                data.forEach((item, index) => {
                    let timelineHtml = '';
                    if (item.timeline && Array.isArray(item.timeline) && item.timeline.length > 0) {
                        timelineHtml = '<div class="mt-6 bg-blue-50 p-4 rounded-lg border border-blue-100"><h4 class="text-xs font-bold text-[#004098] mb-3 uppercase">Timeline / 赛程节点</h4><div class="space-y-0">';
                        item.timeline.forEach(node => {
                            timelineHtml += `
                                <div class="timeline-item">
                                    <div class="timeline-dot"></div>
                                    <div class="flex justify-between items-start text-sm">
                                        <span class="font-bold text-gray-700 w-24 shrink-0">${node.date}</span>
                                        <span class="text-gray-600 flex-1">${node.event}</span>
                                    </div>
                                </div>
                            `;
                        });
                        timelineHtml += '</div></div>';
                    }

                    let attachHtml = '';
                    if (item.attachment_url) {
                        attachHtml = `<a href="${item.attachment_url}" target="_blank" class="inline-flex items-center text-sm text-[#004098] hover:underline mt-4"><i class="fa-solid fa-file-arrow-down mr-2"></i> 下载相关文档</a>`;
                    }

                    const imgUrl = item.image_url || 'https://images.unsplash.com/photo-1550751827-4bd374c3f58b?q=80&w=2070';
                    
                    html += `
                        <div class="relative flex flex-col md:flex-row gap-8 bg-gray-50 p-6 rounded-lg shadow-sm border border-gray-200 hover:shadow-md transition">
                            <div class="w-full md:w-1/3 h-56 md:h-auto overflow-hidden rounded shadow-sm shrink-0">
                                <img src="${imgUrl}" class="w-full h-full object-cover transform hover:scale-105 transition duration-500" alt="${item.title}">
                            </div>
                            <div class="flex-1 flex flex-col">
                                <div class="flex flex-wrap justify-between items-start mb-2">
                                    <h3 class="text-xl font-bold text-[#333] hover:text-[#004098] transition">${item.title}</h3>
                                    <span class="bg-[#004098] text-white text-xs px-2 py-1 rounded shadow-sm whitespace-nowrap mt-1 md:mt-0">${item.date_range || '时间未定'}</span>
                                </div>
                                <div class="text-sm text-gray-500 mb-4 flex items-center"><i class="fa-solid fa-location-dot mr-2"></i> ${item.location || '线上/线下'}</div>
                                <p class="text-gray-600 text-sm leading-relaxed line-clamp-3 mb-auto">${item.summary || '暂无简介'}</p>
                                ${timelineHtml}
                                <div class="flex justify-between items-center mt-4 border-t border-gray-200 pt-4">
                                    ${attachHtml}
                                    <a href="activity-detail.html?id=${item.id}" class="text-sm font-bold text-gray-500 hover:text-[#004098] transition ml-auto">查看回顾详情 <i class="fa-solid fa-arrow-right ml-1"></i></a>
                                </div>
                            </div>
                        </div>
                    `;
                });

                html += `</div></div>`;
                container.innerHTML = html;

            } catch (err) {
                console.error(err);
                container.innerHTML = '<div class="text-center text-red-500 py-10">数据加载失败，请检查网络连接</div>';
            }
        }

        // 初始化
        document.addEventListener('DOMContentLoaded', async () => {
            await initTabs();
            loadActivities();
        });
    </script>
    <script type="module" src="js/search.js"></script>
</body>
</html>